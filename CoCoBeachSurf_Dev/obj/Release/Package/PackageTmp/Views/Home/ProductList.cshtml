@model IEnumerable<AuthModule.vw_tblProducts>

@{

}
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    table {
        width: 100%;
    }

    th {
        font-size: 14px;
        font-weight: 500;
        background-color: black;
        color: white;
    }

    .table th,
    .table td {
        border: none !important;
        vertical-align: central !important;
        padding: 4px !important;
        border-right: 1px solid #fff !important;
        text-align: center;
    }

    #loader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url('/Images/loader.gif') 50% 50% no-repeat rgb(249,249,249);
    }

    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    .modal1 {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }
    .modal1-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    /* The Close Button */
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    .close1 {
        color: white;
        background-color: #f60909;
        font-size: 14px;
        font-weight: bold;
    }

        .close1:hover,
        .close1:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    .modal-backdrop.in{
        z-index:auto !important;
    }
</style>

<div style=" padding-top: 70px;">
    <p style="margin-left: -120px; position: fixed; display: flex; flex-direction: column;">

        <a href="~/Home/CategoryList" title="Category">
            <img src="~/Images/Category.jpg" style="width:55px; height:50px;" alt="Logo" />
        </a>
        <a href="~/Home/CreditAppDDList" title="CreditApp" style="margin-top: 20px;">
            <img src="~/Images/CreditAppDD.png" style="width:55px; height:50px;" alt="Logo" />
        </a>

    </p>
    @*<button id="myBtn" class="btn btn-default" type="button" style="background-color: #de3737; border: none; margin-top: -141px; margin-left: 1100px; ">
            <i class="fa fa-plus text-blue" style="color:white"></i>
        </button>*@
    <!--<table class="table tab-content table-responsive" style="margin-top:-60px">
        <tr style="background-color:black;color:white">
            <th>
                @Html.DisplayName("Category")
            </th>
            <th>
                @Html.DisplayName("Product")
            </th>
            <th>
                @Html.DisplayName("Product Code")
            </th>
            <th>
                @Html.DisplayName("Price")
            </th>
            <th>
                @Html.DisplayName("Active")
            </th>

            <th></th>
        </tr>
        <tr>
            <td style="display:none">
                @Html.TextBox("ProductId", "", new { @class = "form-control" })
            </td>
            <td>
                @Html.DropDownList("Category", new SelectList(ViewBag.CatList, "CatId", "Category"), "Select", new {  @id = "CatId", @class = "form-control", @style = " background-color: #ebeaea;" })
            </td>
            <td>
                @Html.TextBox("Product", "", new { @class = "form-control" })
            </td>
            <td>
                @Html.TextBox("Code", "", new { @class = "form-control" })
            </td>
            <td>
                @Html.TextBox("Price", "", new { @class = "form-control" })
            </td>
            <td>-->
    @*@Html.TextBox("Active", "", new { @class = "form-control" })*@
    <!--@Html.DropDownList("Active", new List<SelectListItem>
                  {
                      new SelectListItem { Text = "True", Value = "1",},
                      new SelectListItem { Text = "False", Value = "0"},

                  }, "Select", new { @class = "form-control", @style = " background-color: #ebeaea;" })
            </td>

            <td>
                <button class="btn btn-default SaveProduct" type="button" style="background-color: #14a314; border: none; display: inline-block">
                    <i class="fa fa-save text-red" style="color:white"></i>
                </button>
                <button class="btn btn-default UpdateProduct" type="button" style="background-color: #14a314; border: none;display:none">
                    <i class="fa fa-save text-red" style="color:white"></i>
                </button>
                <button class="btn btn-default ClearAllFields" type="button" style="background-color: #de3737; border: none">
                    <i class="fa fa-times text-red" style="color:white"></i>
                </button>


            </td>
        </tr>

        <tr class="ErrorInfo" style="display:none">


                <td style=" color:red"> Please fill All Data !</td>

        </tr>

    </table>-->
    <h1>Products</h1>
    <table class="table tab-content table-responsive">
        <tr style="background-color:black;color:white">
            <th>
                @Html.DisplayName("Category")
            </th>
            <th>
                @Html.DisplayName("Product Eng")
            </th>
            <th>
                @Html.DisplayName("Product ESP")
            </th>
            <th>
                @Html.DisplayName("Product Code")
            </th>
            <th>
                @Html.DisplayName("Manf Code")
            </th>
            <th>
                @Html.DisplayName("Price")
            </th>
            <th>
                @Html.DisplayName("Active")
            </th>
            <th>
                @Html.DisplayName("Taxable")
            </th>

            <th>
                <button id="myBtn" class="btn btn-default" type="button" data-dismiss="modal" style="background-color: #5bee0a; border: none; color: white; width: 80px; ">
                    Add
                </button>
            </th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td class="ProductId" style="display:none">
                    @Html.DisplayFor(modelItem => item.PrdId)
                </td>
                <td class="CatId" style="display:none">
                    @Html.DisplayFor(modelItem => item.PrdCatId)
                </td>
                <td class="Category">
                    @Html.DisplayFor(modelItem => item.Category)
                </td>
                <td class="ProductName">
                    @Html.DisplayFor(modelItem => item.PrdEngDesc)
                </td>
                <td class="ProductESPDesc">
                    @Html.DisplayFor(modelItem => item.PrdESPDesc)
                </td>
                <td class="ProductCode">
                    @Html.DisplayFor(modelItem => item.PrdCode)
                </td>
                <td class="ProductMfCode">
                    @Html.DisplayFor(modelItem => item.PrdMfCode)
                </td>
                <td class="ProductPrice">
                    @Html.DisplayFor(modelItem => item.PrdPrice)
                </td>
                <td class="Active">
                    @*@Html.DisplayFor(modelItem => item.Active)*@
                    @if (item.PrdStatus == true)
                    {
                        <label>True</label>
                    }
                    else
                    {
                        <label>False</label>
                    }
                </td>
                <td class="ProductTaxable">
                    @*@Html.DisplayFor(modelItem => item.Active)*@
                    @if (item.PrdTaxable == true)
                    {
                        <label>True</label>
                    }
                    else
                    {
                        <label>False</label>
                    }
                </td>

                <td>
                    @*id="myBtn"*@
                    <button data-toggle="modal" data-target="#exampleModal1" class="btn btn-default EditProduct " type="button" style="background-color: orange; border: none; ">
                        <i class="fa fa-edit text-blue" style="color:white"></i>
                    </button>
                    @*<button class="btn btn-default EditProduct" id="myBtn" type="button" style="background-color: orange; border: none">
                            <i class="fa fa-edit text-red" style="color:white"></i>
                        </button>*@
                    <button class="btn btn-default DeleteProduct" type="button" style="background-color: #de3737; border: none">
                        <i class="fa fa-trash text-red" style="color:white"></i>
                    </button>

                    @*<a target="#" class="btn btn-default" style="background-color: orange; border: none" href="" >
                            <i class="fa fa-edit text-red" style="color:white"></i>
                        </a>
                        <a target="#" class="btn btn-default" style="background-color: #de3737; border: none" href="@Url.Action("Delete", "Home")">
                            <i class="fa fa-trash text-red" style="color:white"></i>
                        </a>*@
                </td>
            </tr>
        }

    </table>
</div>
<div id="loader"></div>
@*id="myModal"*@
<div class="modal"id="myModal" >

    <!-- Modal content -->
    @*<div class="modal-content">
            <span class="close">&times;</span>

        </div>*@
    <div class="modal-dialog modal-lg" style="position: unset!important">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title"> <i class="fa fa-user"></i>&nbsp;Add Product</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="col-md-6 modal-body form-parent">
                <div class="form">
                    <label>
                        Category:
                    </label>
                    <div class="input-parent">
                        @Html.DropDownList("Category1", new SelectList(ViewBag.CatList, "CatId", "Category"), "Select", new { @id = "CatId1", @class = "form-control browser-default custom-select", @style = " background-color: #ebeaea;" })
                    </div>

                </div>

                <div class="form">
                    <label>
                        Product ESP:
                    </label>
                    <div class="input-parent">
                        @Html.TextArea("PrdESPDesc1", "", new { @class = "form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Code:
                    </label>
                    <div class="input-parent">
                        @Html.TextBox("Code1", "", new { @class = "form-control" })
                    </div>

                </div>


                <div class="form">
                    <label> Taxable:</label>
                    <div class="input-parent">
                        @*<select class="browser-default custom-select form-control">
                                <option value="">Select </option>
                                <option value="">Yes</option>
                                <option value="">No</option>

                            </select>*@
                        @Html.DropDownList("PrdTaxable1", new List<SelectListItem>
                   {
                       new SelectListItem { Text = "True", Value = "1",},
                       new SelectListItem { Text = "False", Value = "0"},

                   }, "Select", new { @class = "browser-default custom-select form-control" })
                    </div>

                </div>



            </div>
            <div class="col-md-6 modal-body form-parent">
                <div class="form">
                    <label> Active:</label>
                    <div class="input-parent">
                        @*<select class="browser-default custom-select form-control">
                                <option value="">Select</option>
                                <option value="">Yes</option>
                                <option value="">No</option>

                            </select>*@
                        @Html.DropDownList("Active1", new List<SelectListItem>
                   {
                       new SelectListItem { Text = "True", Value = "1",},
                       new SelectListItem { Text = "False", Value = "0"},

                   }, "Select", new { @class = "browser-default custom-select form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Product Eng:
                    </label>
                    <div class="input-parent">
                        @Html.TextArea("Product1", "", new { @class = "form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Manfacturing Code:
                    </label>
                    <div class="input-parent">
                        @Html.TextBox("PrdMfCode1", "", new { @class = "form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Price:
                    </label>
                    <div class="input-parent">
                        @Html.TextBox("Price1", "", new { @class = "form-control" })
                    </div>

                </div>

            </div>
            <div class="modal-footer" style="display:block">

                @*<button class="btn btn-success SaveProduct" data-toggle="tooltip" data-placement="bottom" title="Save Product">
            <i class="fa fa-save text-white"></i>&nbsp;
        </button>*@
                <button class="btn btn-default SaveProduct" type="button" style="background-color: #14a314; border: none; display: inline-block">
                    <i class="fa fa-save text-red" style="color:white"></i>
                </button>
                <button class="btn btn-default UpdateProduct" type="button" style="background-color: #14a314; border: none;display:none">
                    <i class="fa fa-save text-red" style="color:white"></i>
                </button>
                @*<button class=" close1" id="Cancel" data-toggle="tooltip" data-dismiss="modal" data-placement="bottom" title="Cancel">
                    <i class="fa fa-close text-white"></i>&nbsp;
                </button>*@
            <button type="button" class=" btn close1" data-dismiss="modal">
                @*&times;*@
                <i class="fa fa-close text-white"></i>
            </button>
            </div>

        </div>
    </div>
</div>
<div class="modal1" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModal1Label">

    <!-- Modal content -->
    @*<div class="modal-content">
            <span class="close">&times;</span>

        </div>*@
    <div class="modal1-dialog modal-lg" style="position: unset!important">
        <div class="modal1-content" style=" margin-right: -165px;">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title"> <i class="fa fa-user"></i>&nbsp;Add Product</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="col-md-6 modal-body form-parent">
                <div class="form">
                    <label>
                        Category:
                    </label>
                    <div class="input-parent">
                        @Html.DropDownList("Category", new SelectList(ViewBag.CatList, "CatId", "Category"), "Select", new { @id = "CatId", @class = "form-control browser-default custom-select", @style = " background-color: #ebeaea;" })
                    </div>

                </div>
              
                <div class="form">
                    <label>
                        Product ESP:
                    </label>
                    <div class="input-parent">
                        @Html.TextArea("PrdESPDesc", "", new { @class = "form-control" })
                        @Html.Hidden("ProductId", "", new { @class = "form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Code:
                    </label>
                    <div class="input-parent">
                        @Html.TextBox("Code", "", new { @class = "form-control" })
                    </div>

                </div>


                <div class="form">
                    <label> Taxable:</label>
                    <div class="input-parent">
                        @*<select class="browser-default custom-select form-control">
                    <option value="">Select </option>
                    <option value="">Yes</option>
                    <option value="">No</option>

                </select>*@
                        @Html.DropDownList("PrdTaxable", new List<SelectListItem>
                   {
                       new SelectListItem { Text = "True", Value = "1",},
                       new SelectListItem { Text = "False", Value = "0"},

                   }, "Select", new { @class = "browser-default custom-select form-control" })
                    </div>

                </div>



            </div>
            <div class="col-md-6 modal-body form-parent">
                <div class="form">
                    <label> Active:</label>
                    <div class="input-parent">
                        @*<select class="browser-default custom-select form-control">
                                <option value="">Select</option>
                                <option value="">Yes</option>
                                <option value="">No</option>

                            </select>*@
                        @Html.DropDownList("Active", new List<SelectListItem>
                   {
                       new SelectListItem { Text = "True", Value = "1",},
                       new SelectListItem { Text = "False", Value = "0"},

                   }, "Select", new { @class = "browser-default custom-select form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Product Eng:
                    </label>
                    <div class="input-parent">
                        @Html.TextArea("Product", "", new { @class = "form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Manfacturing Code:
                    </label>
                    <div class="input-parent">
                        @Html.TextBox("PrdMfCode", "", new { @class = "form-control" })
                    </div>

                </div>
                <div class="form">
                    <label>
                        Price:
                    </label>
                    <div class="input-parent">
                        @Html.TextBox("Price", "", new { @class = "form-control" })
                    </div>

                </div>

            </div>
            <div class="modal-footer" style="display:block">

                @*<button class="btn btn-success SaveProduct" data-toggle="tooltip" data-placement="bottom" title="Save Product">
                        <i class="fa fa-save text-white"></i>&nbsp;
                    </button>*@
                <button class="btn btn-default SaveProduct" type="button" title="Save" style="background-color: #14a314; border: none; display: inline-block">
                    <i class="fa fa-save text-red" style="color:white"></i>
                </button>
                <button class="btn btn-default UpdateProduct" type="button" title="Update" style="background-color: #14a314; border: none;display:none">
                    <i class="fa fa-save text-red" style="color:white"></i>
                </button>
                <button class="  btn btn-danger" id="Cancel" data-toggle="tooltip" data-dismiss="modal" data-placement="bottom" title="Cancel">
                    <i class="fa fa-close text-white"></i>&nbsp;
                </button>
            </div>

        </div>
    </div>
</div>





<script src="https://code.jquery.com/jquery-1.8.2.js"></script>

<script type="text/javascript">
    var modal = document.getElementById("myModal");
    var modal1 = document.getElementById("exampleModal1");
    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    var span1 = document.getElementsByClassName("close1")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function () {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }
    span1.onclick = function () {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    $(window).load(function () {
        $("#loader").fadeOut(1000);
    });
    function EditProduct(element) {
        alert(element);
    }

    $(".EditProduct").click(function () {
        var $row = $(this).closest("tr");    // Find the row
        var $ProductId = $row.find(".ProductId").text()
        var $ProductName = $row.find(".ProductName").text(); // Find the text
        var $ProductESPDesc = $row.find(".ProductESPDesc").text();
        var $ProductCode = $row.find(".ProductCode").text();
        var $ProductPrice = $row.find(".ProductPrice").text();
        var $Active = $row.find(".Active").text();
        var $CatId = $row.find(".CatId").text();
        var $ProductMfCode = $row.find(".ProductMfCode").text();
        var $ProductTaxable = $row.find(".ProductTaxable").text();
        $('#ProductId').val($ProductId.trim())
        $('#Product').val($ProductName.trim());
        $('#Code').val($ProductCode.trim());
        $('#Price').val($ProductPrice.trim());
        $('#PrdESPDesc').val($ProductESPDesc.trim());
        $('#PrdMfCode').val($ProductMfCode.trim());
        /*$('#PrdTaxable').val($ProductTaxable.trim());*/
        if ($Active.trim() == "True") { $('#Active').val("1") }
        else { $('#Active').val("0") }
        if ($ProductTaxable.trim() == "True") { $('#PrdTaxable').val("1") }
        else { $('#PrdTaxable').val("0") }
        $('#CatId').val($CatId.trim());
        $('.UpdateProduct').css({ 'display': 'inline-block' });
        $('.SaveProduct').css({ 'display': 'none' });
        // Let's test it out
        //alert($text);
    });
    $(".ClearAllFields").click(function () {
        $('#Product').val("");
        $('#Code').val("");
        $('#Price').val("");
        $('#Active').val("");

    });
    $(".SaveProduct").click(function () {
        $('#Product').val();
        $('#Code').val();
        $('#Price').val();
        $('#Active').val();
        if ($('#Product1').val() != "" && $('#Code1').val() != "" && $('#Price1').val() !== "") {
            $.post("/Home/SaveProducts",
                {
                    ProductName: $('#Product1').val(),
                    Code: $('#Code1').val(),
                    Price: $('#Price1').val(),
                    Active: $('#Active1').val(),
                    CatId: $('#CatId').val(),
                    PrdMfCode: $('#PrdMfCode1').val(),
                    PrdESPDesc: $('#PrdESPDesc1').val(),
                    PrdTaxable: $('#PrdTaxable1').val()

                },
                function (data, status) {
                    if (data != "1")
                        Console.Log(data)
                    if (data == "1") {
                        alert("Success")
                        $(".ClearAllFields").click();
                        location.reload();

                    }
                    //alert("Data: " + data + "\nStatus: " + status);
                    //alert("Changed!");
                });
        }
        else {
            $('.ErrorInfo').css({ 'display': 'inline-block' });
            //alert("Please Fill Data")
        }

    });
    $(".UpdateProduct").click(function () {
        $('#item_PrdId').val();
        $('#Product').val();
        $('#Code').val();
        $('#Price').val();
        $('#Active').val();

        $.post("/Home/UpdateProducts",
            {
                PrdId: $('#ProductId').val(),
                ProductName: $('#Product').val(),
                Code: $('#Code').val(),
                Price: $('#Price').val(),
                Active: $('#Active').val(),
                CatId: $('#CatId').val(),
                PrdMfCode: $('#PrdMfCode').val(),
                PrdESPDesc: $('#PrdESPDesc').val(),
                PrdTaxable: $('#PrdTaxable').val()
            },
            function (data, status) {
                if (data != "1")
                    Console.Log(data)
                if (data == "1") {
                    alert("Success")
                    $(window).load(function () {
                        $("#loader").fadeOut(10000);
                    });

                    $(".ClearAllFields").click();
                    location.reload();

                }
                //alert("Data: " + data + "\nStatus: " + status);
                //alert("Changed!");
            });

    });

    $(".DeleteProduct").click(function () {
        var $row = $(this).closest("tr");    // Find the row
        var $ProductId = $row.find(".ProductId").text()
        $('#ProductId').val();
        $('#Product').val();
        $('#Code').val();
        $('#Price').val();
        $('#Active').val();
        $(window).load(function () {
            $("#loader").fadeOut(1000);
        });
        $.post("/Home/DeleteProducts",
            {
                PrdId: $ProductId.trim()

            },
            function (data, status) {
                if (data != "1")
                    Console.Log(data)
                if (data == "1") {
                    alert("Deleted !")
                    location.reload();

                }
                //alert("Data: " + data + "\nStatus: " + status);
                //alert("Changed!");
            });

    });
    $('body').on("click", "a.popup", function (e) {
        e.preventDefault();
        var page = $(this).attr('href');
        OpenPopup(page)
            ;
    });
    $(".Addpopup").click(function (e) {
        $('#MyPopUp').modal('show');
    })
    function OpenPopup(Page) {
        var $pageContent = $('<div/>');
        $pageContent.load(Page)
            ;
        $dialog = $('<div class="popupWindow" style="overflow:hidden"></div>')
            .html($pageContent)
            .dialog({
                draggable: true,
                autoOpen: false,
                resizable: true,
                model: true,
                height: 600,
                width: 300,
                close: function () {
                    $dialog.dialog('destroy').remove();
                }
            })
        $dialog.dialog('open');
    }

    $(function () {
        $('#exampleModal').on('show.bs.modal', function (e) {
            $('.modalTextInput').val('');
            let btn = $(e.relatedTarget); // e.related here is the element that opened the modal, specifically the row button
            let id = btn.data('id'); // this is how you get the of any `data` attribute of an element
            $('.saveEdit').data('id', id); // then pass it to the button inside the modal
        })

        $('.saveEdit').on('click', function () {
            let id = $(this).data('id'); // the rest is just the same
            saveNote(id);
            $('#exampleModal').modal('toggle'); // this is to close the modal after clicking the modal button
        })
    })

    function saveNote(id) {
        let text = $('.modalTextInput').val();
        $('.recentNote').data('note', text);
        console.log($('.recentNote').data('note'));
        console.log(text + ' --> ' + id);
    }

    $(function () {
        $('#exampleModal1').on('show.bs.modal', function (e) {
            $('.modalTextInput').val('');
            let btn = $(e.relatedTarget); // e.related here is the element that opened the modal, specifically the row button
            let id = btn.data('id'); // this is how you get the of any `data` attribute of an element
            //$('.saveEdit').data('id', id); // then pass it to the button inside the modal
            $('#exampleModal1').appendTo("body").modal('show');
        })

        $('.saveEdit').on('click', function () {
            let id = $(this).data('id'); // the rest is just the same
            saveNote(id);
            $('#exampleModal1').modal('toggle'); // this is to close the modal after clicking the modal button
        })
        
    })
    

</script>

